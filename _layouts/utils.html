{# Functions for templates #}
{# ----------------------- #}

{# Functions for home sections #}

{%- macro home_section(category, site, thumbnail_width=-1, inner_shadow=false) -%}
    {# Create home section #}
    <div class="container-fluid home-section {{ "inner-shadow" if inner_shadow }}">
        <a href={{ category.url }}><h1 class="home-section-title">{{ category.title }}</h1></a>
        {%- if category.content is defined -%}
            {%- for page in category.content -%}
                {{ item(page, site, thumbnail_width=thumbnail_width) }}
            {%- endfor -%}
        {%- else -%}
            {{ item(category, site, thumbnail_width=thumbnail_width, show_title=false) }}
        {%- endif -%}
    </div>
{%- endmacro -%}


{%- macro item(page, site, alignment='left', thumbnail_width=-1, show_title=true) -%}
    {# Override alignment if "home_alignment" exist in "page" #}
    {%- if page.home_alignment is defined -%}
        {% set alignment = page.home_alignment %}
    {%- endif -%}
    {# Create item #}
    <div class="row home-item">
        {%- if alignment == "left" -%}
            {{ thumbnail(page, site, thumbnail_width=thumbnail_width) }}
        {%- endif -%}
        {%- if page.layout == 'publication' -%}
            {{ publication_text(page, site) }}
        {%- elif page.layout == 'poster' -%}
            {{ poster_text(page, site) }}
        {%- else -%}
            {{ item_text(page, show_title) }}
        {%- endif -%}
        {%- if alignment == "right" -%}
            {{ thumbnail(page, site, thumbnail_width=thumbnail_width) }}
        {%- endif -%}
    </div>
{%- endmacro -%}


{%- macro item_text(page, show_title=true) -%}
    {# Create text for a regular home item #}
    <div class="col-md-10">
        {%- if show_title -%}
            <a href={{ page.url }}> <h2 class="item">{{ page.title }}</h2> </a>
        {%- endif -%}
        <p class="item">{{ page.summary }}</p>
    </div>
{%- endmacro -%}


{%- macro publication_text(article, site) -%}
    {# Create text for a publication home item #}
    <div class="col-md-10">
        <a href={{ article.url }}><h2 class="item">{{ article.title }}</h2></a>
        <p class="item">
            {{ get_authors(article, site) }} ({{ article.date.year }})
        </p>
        <p class="item">
            <em>{{ article.journal }}.</em>
            {%- if article.doi is defined -%}
                {{ " doi: " }}
                <a href="https://www.doi.org/{{ article.doi }}">{{ article.doi }}</a>.
            {%- endif -%}
            {%- if article.inreview -%}
                {{ " " }}
                <span class="text-warning">
                    This article is <strong>under peer-review</strong>.
                </span>
            {%- endif -%}
        </p>
    </div>
{%- endmacro -%}


{%- macro poster_text(poster, site) -%}
    {# Create text for a poster home item #}
    <div class="col-md-10">
        <a href={{ poster.url }}><h2 class="item">{{ poster.title }}</h2></a>
        <p class="item">
            {{ get_authors(poster, site) }} ({{ poster.date.year }})
        </p>
        <p class="item">
            Presented at
            {%- if poster.meeting_url is defined -%}
                <a href="{{ poster.meeting_url }}">
            {%- endif -%}
            {{ " " + poster.meeting }}.
            {%- if poster.meeting_url is defined -%}
                </a>
            {%- endif -%}
            {%- if poster.doi is defined -%}
                {{ " doi: " }}
                <a href="https://www.doi.org/{{ poster.doi }}">{{ poster.doi }}</a>.
            {%- endif -%}
        </p>
    </div>
{%- endmacro -%}


{%- macro thumbnail(page, site, thumbnail_width=-1) -%}
    {# Create thumbnail for home item #}
    <div class="col-md-2">
        <a href={{ page.url }}>
        {%- if thumbnail_width > 0 -%}
            <img
                class="img-responsive img-circle center-block"
                src="/{{ site.images_path }}/{{ page.thumbnail }}"
                width={{ thumbnail_width }}
            >
        {%- else -%}
            <img
                class="img-responsive img-circle"
                src="/{{ site.images_path }}/{{ page.thumbnail }}"
            >
        {%- endif -%}
        </a>
    </div>
{%- endmacro -%}


{# ------------------------------------------------------- ------------------------- #}

{# Other functions #}

{%- macro get_authors(article, site, fancy=true) -%}
    {# Make the author list by expanding the stubs into full names from "site.authors" #}
    {%- for author in article.author.split(', ') -%}
        {%- if fancy and author == "me" -%}
            {% set author_name = "<strong>" + site.authors[author] + "</strong>" -%}
        {%- else -%}
            {% set author_name = site.authors[author] -%}
        {%- endif -%}
        {{ author_name }}
        {%- if not loop.last -%}
            {%- if loop.revindex == 2 -%}
                {{ " and " }}
            {%- else -%}
                {{ ", " }}
            {%- endif -%}
        {%- endif -%}
    {%- endfor -%}
{%- endmacro -%}


{%- macro draw_icon(icon, site, size='', url=false) -%}
    {%- set icon = site.icons[icon] -%}
	{%- if url -%}
		<a href="{{ url }}">
	{%- endif -%}
    {%- if icon.family == "fontawesome" -%}
        <i class="{{ icon.style }} fa-{{ icon.icon }} {{ size }}" title="{{ icon.title }}"></i>
    {%- elif icon.family == "academicons" -%}
        <i class="{{ icon.style }} ai-{{ icon.icon }} {{ size }}" title="{{ icon.title }}"></i>
	{%- endif -%}
	{%- if url -%}
		</a>
	{%- endif -%}
{%- endmacro -%}


{%- macro make_breadcrums(page) -%}
    {% if page.breadcrumbs %}
        <ol class="breadcrumb">
            <li><a href="/">Home</a></li>
            {% for bc in page.breadcrumbs[:-1] %}
                <li><a href="{{bc.url}}">{{bc.title}}</a></li>
            {% endfor %}
            <li class="active">{{page.breadcrumbs[-1].title}}</li>
        </ol>
    {% endif %}
{%- endmacro -%}


{%- macro make_toc(page) -%}
    {% if page.toc %}
        <div class="col-md-3" role="complementary">
            <nav class="hidden-print hidden-xs hidden-sm">
                <div class="sidebar" data-spy="affix" data-offset-top="80" data-offset-bottom="60">
                    <div class="well">
                        <a href="#"><strong>{{page.title}}</strong></a>
                        {{page.toc}}
                    </div>
                </div>
            </nav>
        </div>
    {% endif %}
{%- endmacro -%}


{%- macro figure(image, site, caption='') -%}
	<figure>
        <img src="/{{ site.images_path }}/{{ image }}" class="img-responsive" alt="{{caption}}">
        {%- if caption -%}
			<figcaption class="text-left"><em>{{caption}}</em></figcaption>
        {%- endif -%}
	</figure>
{%- endmacro -%}
