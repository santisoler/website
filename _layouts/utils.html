{# Functions for templates #}
{# ----------------------- #}

{# Functions for home sections #}

{%- macro home_section(category, site, thumbnail_width=-1) -%}
    {# Create home section #}
    <div class="container">
        <a href={{ category.url }}><h3 class="home-section-title">{{ category.title }}</h3></a>
        {%- if category.content is defined -%}
            {%- for page in category.content -%}
                {{ item(page, site, thumbnail_width=thumbnail_width) }}
            {%- endfor -%}
        {%- else -%}
            {{ item(category, site, thumbnail_width=thumbnail_width, show_title=false) }}
        {%- endif -%}
    </div>
{%- endmacro -%}


{%- macro item(page, site, alignment='left', thumbnail_width=-1, show_title=true) -%}
    {# Override alignment if "home_alignment" exist in "page" #}
    {%- if page.home_alignment is defined -%}
        {% set alignment = page.home_alignment %}
    {%- endif -%}
    {# Create item #}
    <div class="row home-section-row">
        {%- if alignment == "left" -%}
            {{ thumbnail(page, thumbnail_width=thumbnail_width) }}
        {%- endif -%}
        {%- if page.layout == 'publication' -%}
            {{ publication_text(page, site) }}
        {%- else -%}
            {{ item_text(page, show_title) }}
        {%- endif -%}
        {%- if alignment == "right" -%}
            {{ thumbnail(page, thumbnail_width=thumbnail_width) }}
        {%- endif -%}
    </div>
{%- endmacro -%}


{%- macro item_text(page, show_title=true) -%}
    {# Create text for a regular home item #}
    <div class="col-md-10">
        {%- if show_title -%}
            <a href={{ page.url }}> <h4>{{ page.title }}</h4> </a>
        {%- endif -%}
        {{ page.summary }}
    </div>
{%- endmacro -%}


{%- macro publication_text(article, site) -%}
    {# Create text for a publication home item #}
    <div class="col-md-10">
        <a href={{ article.url }}><h4>{{ article.title }}</h4></a>
        <p>{{ get_authors(article, site) }} ({{ article.date.year }})</p>
        <p>
            <em>{{ article.journal }}</em>
            {%- if article.doi is defined -%}
                . doi: <a href="https://www.doi.org/{{ article.doi }}">{{ article.doi }}</a>
            {%- endif -%}
            {%- if article.inreview -%}
                . <strong>This article is under peer-review.</strong>
            {%- endif -%}
        </p>
    </div>
{%- endmacro -%}


{%- macro thumbnail(page, thumbnail_width=-1) -%}
    {# Create thumbnail for home item #}
    <div class="col-md-2 align-middle">
        <a href={{ page.url }}>
        {%- if thumbnail_width > 0 -%}
            <img src="/images/{{ page.thumbnail }}" width={{ thumbnail_width }} class="img-responsive img-circle center-block">
        {%- else -%}
            <img src="/images/{{ page.thumbnail }}" class="img-responsive img-circle">
        {%- endif -%}
        </a>
    </div>
{%- endmacro -%}


{# ------------------------------------------------------- ------------------------- #}

{# Other functions #}

{%- macro get_authors(article, site, fancy=true) -%}
    {# Make the author list by expanding the stubs into full names from "site.authors" #}
    {%- for author in article.author.split(', ') -%}
        {%- if fancy and author == "me" -%}
            {% set author_name = "<strong>" + site.authors[author] + "</strong>" -%}
        {%- else -%}
            {% set author_name = site.authors[author] -%}
        {%- endif -%}
        {{ author_name }}{% if not loop.last %}, {% endif %}
    {%- endfor -%}
{%- endmacro -%}


{%- macro fa(icon, site, size='') -%}
    {%- set icon = site.fa_icons[icon] -%}
	{%- if icon.url -%}
		<a href="{{ icon.url }}">
	{%- endif -%}
    <i class="{{ icon.style }} fa-{{ icon.icon }} {{ size }}" title="{{ icon.title }}"></i>
	{%- if url != '' -%}
		</a>
	{%- endif -%}
{%- endmacro -%}


{%- macro make_breadcrums(page) -%}
    {% if page.breadcrumbs %}
        <ol class="breadcrumb">
            <li><a href="/">Home</a></li>
            {% for bc in page.breadcrumbs[:-1] %}
                <li><a href="{{bc.url}}">{{bc.title}}</a></li>
            {% endfor %}
            <li class="active">{{page.breadcrumbs[-1].title}}</li>
        </ol>
    {% endif %}
{%- endmacro -%}


{%- macro make_toc(page) -%}
    {% if page.toc %}
        <div class="col-md-3" role="complementary">
            <nav class="hidden-print hidden-xs hidden-sm">
                <div class="sidebar" data-spy="affix" data-offset-top="80" data-offset-bottom="60">
                    <div class="well">
                        <a href="#"><strong>{{page.title}}</strong></a>
                        {{page.toc}}
                    </div>
                </div>
            </nav>
        </div>
    {% endif %}
{%- endmacro -%}


{%- macro figure(image, caption='') -%}
	<figure>
        <img src="/images/{{ image }}" class="img-responsive" alt="{{caption}}">
        {%- if caption -%}
			<figcaption class="text-left"><em>{{caption}}</em></figcaption>
        {%- endif -%}
	</figure>
{%- endmacro -%}
